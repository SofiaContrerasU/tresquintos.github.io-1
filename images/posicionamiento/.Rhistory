theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot4
ggsave(plot = plot4, "puntos_ideales_vamosporchile.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento 155 Constituyentes
plot3 <-  ggplot(d1, aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.01) +   # Draw dashed lines
labs(title="Convención Constitucional",
x="Constituyente",
y="Izquierda                                                         Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme(axis.text.y = element_text(size = 1))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot3
ggsave(plot = plot3, "puntos_ideales_nombres2.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento 155 Constituyentes
plot3 <-  ggplot(d1, aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.01) +   # Draw dashed lines
labs(title="Convención Constitucional",
x="Constituyente",
y="Izquierda                                                         Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 1))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot3
ggsave(plot = plot3, "puntos_ideales_nombres2.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento No Neutrales
plot5 <- ggplot(filter(d1, party == "No Neutrales"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="No Neutrales",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot5
ggsave(plot = plot5, "puntos_ideales_noneutrales.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# SETTINGS
###################################################
rm(list=ls())
setwd("/Users/kennethbunker/Dropbox/GitHub/tresquintos.github.io/images/posicionamiento/")
###################################################
# REFERENCES
###################################################
# https://github.com/jaytimm/mds-for-linguists/blob/master/README.md
# https://github.com/imfd/notas-blog/blob/main/nominate/20%20Septiembre/DW-Nominate.R
# Dataset only has "1", "6" and "9"
###################################################
# LIBRARY
###################################################
if (!require("pacman")) install.packages("pacman")
pacman::p_load(# anominate, -- no longer maintained --
wnominate,
pscl,
ggplot2,
knitr,
devtools,
ggrepel,
writexl,
data.table)
library(coda)
library(purrr)
library(dplyr)
library(tidyverse)
library(rvest)
library(tidytext)
library(stringi)
library(stringr)
library(readxl)
library(pscl)
library(wnominate)
###################################################
# CC DATA
###################################################
## csv file mine
raw_data <- read.csv("/Users/kennethbunker/Dropbox/Tresquintos/Convención 2021/legislativo/votación pleno/votación particular.csv",stringsAsFactors=FALSE, header=TRUE,strip.white=TRUE)
## Use alternative party labels
legData2<-raw_data$bancada
## Erase other votes
raw_data[1:4] <- list(NULL)
raw_data[2:5] <- list(NULL)
raw_data[3:17] <- list(NULL)
raw_data[982:991] <- list(NULL)
## Coding Standards
raw_data[raw_data=="a favor"] <- "1"
raw_data[raw_data=="en contra"] <- "6"
raw_data[raw_data=="abstencion"] <- "9"
raw_data[raw_data=="na"] <- "9"
raw_data[raw_data==" "] <- "9"
raw_data[raw_data==""] <- "9"
raw_data[raw_data=="  "] <- "9"
## Transformation
CC<-as.matrix(raw_data)
CC[1:5,1:6]
CCnames<-CC[,1]
#legData<-matrix(CC[,2],length(CC[,2]),1)
legData <- matrix(legData2)
colnames(legData)<-"party"
CC<-CC[,-c(1,2)]
## Roll Call format
rc <- rollcall(CC, yea=c(1,2,3), nay=c(4,5,6),
missing=c(7,8,9),notInLegis=0, legis.names=CCnames,
legis.data=legData,
desc="CC Votes",
source="tresquintos.cl")
## Get Ideal Points (Isabel Godoy; Tere Marinovic)
result <- wnominate(rc, dims = 2, polarity = c(143,50))
summary(result)
## Plot WNominate
plot(result)
## Export data
ordenamiento <- summary(result, verbose=TRUE)
write_xlsx(ordenamiento,"/Users/kennethbunker/Dropbox/Tresquintos/Convención 2021/legislativo/ideologico/ordenamiento.xlsx")
## Something for plot2
d1 <- cbind(label=rownames(result$legislators), result$legislators)
d1 <- d1[order(d1$coord1D),]
## invert coordinates (so right is on the right)
d1$new_coord1D <- -1*d1$coord1D
## Plot 0
plot0 <- ggplot()  +
geom_hline(yintercept=0.0, linetype="dashed", color = "red", size=0.2) +
geom_text(data = d1,
aes(x=reorder(label,new_coord1D),
y=new_coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Izquierda                                                                                                   Derecha')+
theme(plot.title = element_text(hjust = 0.5)) +
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
plot0
ggsave(plot = plot0, "puntos_ideales_nombres.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# PLOTS
###################################################
# Reconstruccion usando datos paquete wnominate
df_graph <- data.frame(name=rownames(result$legislators),coalicion=result$legislators$party,coord=result$legislators$coord1D,se=result$legislators$se1D)
# Crea funciones mean y sd y las agrega como columnas
mean_valid<-function(x){round(mean(na.omit(x)),3)}
sd_valid<-function(x){round(sd(x,na.rm=TRUE),3)}
df_graph$mean_party<-ave(df_graph$coord,df_graph$coalicion,FUN=mean_valid)
df_graph$sd_party<-ave(df_graph$coord,df_graph$coalicion,FUN=sd_valid)
# Crea columna resumen
for (i in 1:length(df_graph$name)){df_graph$gral[i]<-paste0(df_graph$coalicion[i],'\n Prom:',df_graph$mean[i],' (',df_graph$sd[i],')')}
# Plot W-Nominate (individual) 1 Dimensión
plot1 <- df_graph %>%
ggplot(aes(reorder(name,coord), coord, label=name)) +
xlab("Constituyente") + ylab("Izquierda                     Derecha")+
geom_point(stat='identity', aes(col=coalicion), size=2.5) +
scale_color_viridis_d() + coord_flip()+theme_bw()+ theme(legend.position="top")+
theme(legend.position = c(0.8, 0.4))+
geom_errorbar(aes(ymin=coord-se, ymax=coord+se), width=.2,position=position_dodge(0.05))
plot1
ggsave(plot = plot1, "puntos_ideales_individual.png", width = 5, height = 5, units = "in", dpi = 300)
## Plot W-Nominate (coalición) 1 Dimensión
plot2 <- df_graph %>%
ggplot(aes(reorder(gral,mean_party), coord, label=name)) +
xlab("Coalición") + ylab("Izquierda                     Derechal")+
geom_point(stat='identity', aes(col=coalicion), size=2,alpha = 0.4,show.legend = FALSE) +
scale_color_viridis_d() + coord_flip()+ theme_bw()
plot2
ggsave(plot = plot2, "puntos_ideales_coalicion.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# PLOTS
###################################################
## Posicionamiento 155 Constituyentes
plot3 <-  ggplot(d1, aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.01) +   # Draw dashed lines
labs(title="Convención Constitucional",
x="Constituyente",
y="Izquierda                                                         Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 1))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot3
ggsave(plot = plot3, "puntos_ideales_nombres2.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Vamos por Chile
plot4 <- ggplot(filter(d1, party == "Vamos por Chile"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Vamos por Chile",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot4
ggsave(plot = plot4, "puntos_ideales_vamosporchile.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento No Neutrales
plot5 <- ggplot(filter(d1, party == "No Neutrales"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="No Neutrales",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot5
ggsave(plot = plot5, "puntos_ideales_noneutrales.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Apruebo Dignidad
plot6 <- ggplot(filter(d1, party == "Apruebo Dignidad"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Apruebo Dignidad",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot6
ggsave(plot = plot6, "puntos_ideales_apruebodignidad.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Apruebo Dignidad
plot7 <- ggplot(filter(d1, party == "Lista del Pueblo"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Lista del Pueblo",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot7
ggsave(plot = plot7, "puntos_ideales_listadelpueblo.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Apruebo Dignidad
plot8 <- ggplot(filter(d1, party == "Pueblos Originarios"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Pueblos Originarios",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot8
ggsave(plot = plot8, "puntos_ideales_pueblosoriginarios.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Apruebo Dignidad
plot9 <- ggplot(filter(d1, party == "Lista del Apruebo"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Lista del Apruebo",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot9
ggsave(plot = plot9, "puntos_ideales_lda.png", width = 5, height = 5, units = "in", dpi = 300)
## Posicionamiento Apruebo Dignidad
plot10 <- ggplot(filter(d1, party == "Independientes"), aes(x=reorder(label, -new_coord1D), y=new_coord1D)) +
geom_point(col="tomato2", size=2) +   # Draw points
geom_segment(aes(x=label,
xend=label,
y=min(-1),
#y=min(new_coord1D),
yend=max(1)),
#yend=max(new_coord1D)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Otros Independientes",
x="Constituyente",
y="Izquierda                                       Derecha",
subtitle="Posicionamiento ideológico",
caption="Fuente: tresquintos.cl") +
theme_bw()+
theme(axis.text.y = element_text(size = 6))+
theme(plot.caption=element_text(size=rel(.3)))+
coord_flip()
plot10
ggsave(plot = plot10, "puntos_ideales_independientes.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# CC COMISION MEDIO AMBIENTE
###################################################
## Clean
rm(list=ls())
## csv file mine
raw_data <- read.csv("/Users/kennethbunker/Dropbox/Tresquintos/Convención 2021/legislativo/votación comisiones/5_medio_ambiente.csv",stringsAsFactors=FALSE, header=TRUE,strip.white=TRUE)
## Drop
raw_data[1:1] <- list(NULL)
## Coding Standards
raw_data[raw_data=="a favor"] <- "1"
raw_data[raw_data=="en contra"] <- "6"
raw_data[raw_data=="abstencion"] <- "9"
raw_data[raw_data=="na"] <- "9"
raw_data[raw_data==" "] <- "9"
raw_data[raw_data==""] <- "9"
raw_data[raw_data=="  "] <- "9"
## Prepare data for RC
CC<-as.matrix(raw_data)
CC[1:5,1:6]
CCnames<-CC[,1]
legData<-matrix(CC[,2],length(CC[,2]),1)
colnames(legData)<-"party"
CC<-CC[,-c(1,2)]
## Roll Call format
rc <- rollcall(CC, yea=c(1,2,3), nay=c(4,5,6),
missing=c(7,8,9),notInLegis=0, legis.names=CCnames,
legis.data=legData,
desc="CC Votes",
source="tresquintos.cl")
## Get Ideal Points (Álvarez; Antilef)
result <- wnominate(rc, dims = 2, polarity = c(4,3))
summary(result)
## Plot WNominate
plot(result)
## Something for plot2
d1 <- cbind(label=rownames(result$legislators), result$legislators)
d1 <- d1[order(d1$coord1D),]
## invert coordinates (so right is on the right)
d1$new_coord1D <- -1*d1$coord1D
## Plot 0
plot50 <- ggplot()  +
geom_hline(yintercept=0.0, linetype="dashed", color = "red", size=0.2) +
geom_text(data = d1,
aes(x=reorder(label,new_coord1D),
y=new_coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="Ordenamiento Ideológico Constituyentes", subtitle="Comisión de Medio Ambiente") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Izquierda                                                                                                   Derecha')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 0
plot50
ggsave(plot = plot50, "puntos_ideales_medioambiente.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# CC COMISION JUSTICIA
###################################################
##Clean
rm(list=ls())
## csv file mine
raw_data <- read.csv("/Users/kennethbunker/Dropbox/Tresquintos/Convención 2021/legislativo/votación comisiones/6_sist_justicia.csv",stringsAsFactors=FALSE, header=TRUE,strip.white=TRUE)
## Drop
raw_data[1:1] <- list(NULL)
## Coding Standards
raw_data[raw_data=="a favor"] <- "1"
raw_data[raw_data=="en contra"] <- "6"
raw_data[raw_data=="abstencion"] <- "9"
raw_data[raw_data=="na"] <- "9"
raw_data[raw_data==" "] <- "9"
raw_data[raw_data==""] <- "9"
raw_data[raw_data=="  "] <- "9"
## Prepare data for RC
CC<-as.matrix(raw_data)
CC[1:5,1:6]
CCnames<-CC[,1]
legData<-matrix(CC[,2],length(CC[,2]),1)
colnames(legData)<-"party"
CC<-CC[,-c(1,2)]
## Roll Call format
rc <- rollcall(CC, yea=c(1,2,3), nay=c(4,5,6),
missing=c(7,8,9),notInLegis=0, legis.names=CCnames,
legis.data=legData,
desc="CC Votes",
source="tresquintos.cl")
## Get Ideal Points (Llanquileo; Bown)
result <- wnominate(rc, dims = 2, polarity = c(12,1))
summary(result)
## Plot WNominate
plot(result)
## Something for plot2
d1 <- cbind(label=rownames(result$legislators), result$legislators)
d1 <- d1[order(d1$coord1D),]
## invert coordinates (so right is on the right)
d1$new_coord1D <- -1*d1$coord1D
## Plot 0
plot60 <- ggplot()  +
geom_hline(yintercept=0.0, linetype="dashed", color = "red", size=0.2) +
geom_text(data = d1,
aes(x=reorder(label,new_coord1D),
y=new_coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="Ordenamiento Ideológico Constituyentes", subtitle="Comisión de Justicia") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Izquierda                                                                                                   Derecha')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 0
plot60
ggsave(plot = plot60, "puntos_ideales_justicia.png", width = 5, height = 5, units = "in", dpi = 300)
