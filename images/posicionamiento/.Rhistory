aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
theme(axis.title=element_text(size=rel(.7), angle=0))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
ylim(-1.1, 1.1)+
coord_flip()
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Pauloo, et al. 2017)") +
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
ylim(-1.1, 1.1)+
coord_flip()
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
theme(plot.caption = element_text(hjust = 0)) +
ylim(-1.1, 1.1)+
coord_flip()
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
theme(caption.text.x=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
theme(caption.text=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "(Tresquintos.cl)") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                             Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                                          Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                                                        Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                                                                       Izquierda')+
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="      Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                                                                       Izquierda')+
theme(plot.title = element_text(hjust = 0.5)) +
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
## Plot 2
ggplot()  +
geom_text(data = d1,
aes(x=reorder(label, coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
#  theme_classic() +
theme_minimal() +
labs(title="Ordenamiento Ideológico Constituyentes") +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Derecha                                                                                                       Izquierda')+
theme(plot.title = element_text(hjust = 0.5)) +
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip()
###################################################
# SETTINGS
###################################################
rm(list=ls())
setwd("/Users/kennethbunker/Dropbox/GitHub/tresquintos.github.io/images/posicionamiento/")
###################################################
# REFERENCES
###################################################
# https://github.com/jaytimm/mds-for-linguists/blob/master/README.md
# https://github.com/imfd/notas-blog/blob/main/nominate/20%20Septiembre/DW-Nominate.R
# Dataset only has "1", "6" and "9"
###################################################
# LIBRARY
###################################################
if (!require("pacman")) install.packages("pacman")
pacman::p_load(# anominate, -- no longer maintained --
wnominate,
pscl,
ggplot2,
knitr,
devtools,
ggrepel,
writexl,
data.table)
library(coda)
library(purrr)
library(dplyr)
library(tidyverse)
library(rvest)
library(tidytext)
library(stringi)
library(stringr)
library(readxl)
library(pscl)
library(wnominate)
library(ggridges)
library(ggalt)
library(ggforce)
library(concaveman)
###################################################
# CC DATA
###################################################
## csv file mine
raw_data <- read.csv("/Users/kennethbunker/Dropbox/Tresquintos/Convención 2021/legislativo/votación pleno/votación particular.csv",stringsAsFactors=FALSE, header=TRUE,strip.white=TRUE)
## Choose party label
apellidos <-as.matrix(raw_data$apellido)
legData1 <- raw_data$bancada
legData2 <- raw_data$partido_general
legData3 <- raw_data$comision
legData4 <- raw_data$colectivo
## Choose level of analysis
legData  <- legData4                                                            # CHOOSE HERE THE LEVEL OF ANALYSIS!!
## Erase votes other than a favor/en contra
raw_data[1:4] <- list(NULL)                                 # Drop main IDs
raw_data[2:9] <- list(NULL)                                 # Drop other IDs
raw_data[3:17] <- list(NULL)                                # Drop first round voting (pres/vp)
raw_data[980:989] <- list(NULL)                             # Drop second round voting (pres/vp)
raw_data <- raw_data[,colSums(is.na(raw_data))<nrow(raw_data)]
## Coding (wnominate requirment: 1/6/9)
raw_data[raw_data=="a favor"] <- "1"
raw_data[raw_data=="en contra"] <- "6"
raw_data[raw_data=="abstencion"] <- "9"
raw_data[raw_data=="na"] <- "9"
raw_data[raw_data==" "] <- "9"
raw_data[raw_data==""] <- "9"
raw_data[raw_data=="  "] <- "9"
## Transformation for wnominate
CC<-as.matrix(raw_data)
CC[1:5,1:6]
CCnames<-CC[,1]
#legData<-matrix(CC[,2],length(CC[,2]),1)
legData <- matrix(legData)
colnames(legData)<-"party"
CC<-CC[,-c(1,2)]
## Roll Call format
rc <- rollcall(CC, yea=c(1,2,3), nay=c(4,5,6),
missing=c(7,8,9),notInLegis=0, legis.names=CCnames,
legis.data=legData,
desc="CC Votes",
source="tresquintos.cl")
## Get Ideal Points (Isabel Godoy; Tere Marinovic)
result <- wnominate(rc, dims = 2, polarity = c(50,143), trials=5)
summary(result)
## Plot WNominate
plot(result)
## Something for plot2
d1 <- cbind(label=rownames(result$legislators), result$legislators)
d1 <- d1[order(d1$coord1D),]
## Plot all constituyentes with 2/3rds line
plot0 <- ggplot()  +
geom_hline(yintercept=0.0, linetype="dashed", color = "red", size=0.2) +
geom_text(data = d1,
aes(x=reorder(label,coord1D),
y=coord1D,
label=label),
size=1,
color = 'blue') +
theme_bw() +
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank())+
xlab('') + ylab('Izquierda                                                                                                   Derecha')+
theme(plot.title = element_text(hjust = 0.5)) +
theme(axis.title.x=element_text(size=rel(.7), angle=0))+
theme(axis.text.x=element_text(size=rel(.7), angle=0))+
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
ylim(-1.1, 1.1)+
coord_flip() +
theme(panel.grid.minor.y=element_blank(),panel.grid.major.y=element_blank())+
geom_vline(xintercept = 103, linetype = "dashed", colour = "black", size = .11) +
annotate(x=103,y=-.9,label="Dos Tercios: 103 Constituyentes",geom="label", size=1)+
geom_vline(xintercept = 77.5, linetype = "dashed", colour = "black", size = .11) +
annotate(x=77.5,y=0,label="La mitad: 50%",geom="label", size=1)+
geom_vline(xintercept = 52, linetype = "dashed", colour = "black", size = .11) +
annotate(x=52,y=.9,label="Dos Tercios: 103 Constituyentes",geom="label", size=1)
plot0
ggsave(plot = plot0, "puntos_ideales_nombres.png", width = 5, height = 5, units = "in", dpi = 300)
###################################################
# PLOTS SQUARES
###################################################
# basic graph
#https://ggforce.data-imaginist.com/reference/geom_mark_rect.html
#https://rviews.rstudio.com/2019/09/19/intro-to-ggforce/
## Boxify
plot66 <- ggplot(d1,aes(x = coord1D, y = coord2D, color = party)) +
geom_point(show.legend = TRUE) +
geom_mark_rect() +
theme_bw() +
geom_hline(yintercept=0.0, linetype="dashed", color = "gray", size=0.1) +
geom_vline(xintercept=0.0, linetype="dashed", color = "gray", size=0.1) +
theme(axis.text=element_text(size=6), axis.title=element_text(size=10))+
ylim(-1.1, 1.1)+
xlim(-1.1, 1.1)+
ylab("Liberal/Progresista                                                                              Conservador/Autoritario") +
xlab("Izquierda/Más Estado                                                                                  Menos Estado/Derecha") +
guides(color=guide_legend("Colectivo")) +
scale_color_viridis_d(option = "D") +
theme(legend.position="top")+
theme(legend.position = c(0.85, 0.2)) +
theme(legend.key.size = unit(.2, 'cm'))+
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
theme(legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid'))
plot66
ggsave(plot = plot66, "puntos_ideales_cajas_dosdimensiones.png", width = 7, height = 7, units = "in", dpi = 300)
## select only a few coalitions
# p <- ggplot(subset(d1, party %in% c( "Frente Amplio +", "Mov Sociales")), aes(x = coord1D, y = coord2D))+
###################################################
# PLOTS: INDIVIDUAL POSITIONS + COLECTIVO/PARTIDO/COALICIÓN
###################################################
# Dataframe
df_graph <- data.frame(name=rownames(result$legislators),coalicion=result$legislators$party,coord=result$legislators$coord1D,se=result$legislators$se1D)
# Funciones: mean y sd columnas
mean_valid<-function(x){round(mean(na.omit(x)),3)}
sd_valid<-function(x){round(sd(x,na.rm=TRUE),3)}
df_graph$mean_party<-ave(df_graph$coord,df_graph$coalicion,FUN=mean_valid)
df_graph$sd_party<-ave(df_graph$coord,df_graph$coalicion,FUN=sd_valid)
# Crea columna resumen (no se usa; es mejor solo para info interna)
for (i in 1:length(df_graph$name)){df_graph$gral[i]<-paste0(df_graph$coalicion[i],'\n Prom:',df_graph$mean[i],' (',df_graph$sd[i],')')}
## Apellidos
df_graph <- cbind(df_graph, apellidos)
# Plot W-Nominate (individual) 1 Dimensión
plot1 <- df_graph %>%
ggplot(aes(reorder(apellidos,coord), coord, label=apellidos)) +
xlab("Constituyente") + ylab("Izquierda                     Derecha")+
geom_point(stat='identity', aes(col=coalicion), size=2.5) +
coord_flip() +
theme_bw()+
theme(legend.position="top")+
theme(legend.position = c(0.75, 0.3))+
guides(color=guide_legend("Coalición")) +
scale_color_viridis_d(option = "D") +
#geom_errorbar(aes(ymin=coord-se, ymax=coord+se), width=.2,position=position_dodge(0.05))
geom_errorbar(aes(ymin=coord, ymax=coord), width=.2,position=position_dodge(0.05))+
ylim(-1.1, 1.1)+
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))
plot1
ggsave(plot = plot1, "puntos_ideales_individual.png", width = 5, height = 25, units = "in", dpi = 300)
## Plot W-Nominate (coalición) 1 Dimensión
plot2 <- df_graph %>%
ggplot(aes(reorder(coalicion,mean_party), coord, label=name)) +
xlab("Colectivo") + ylab("Izquierda                                       Derecha")+
geom_point(stat='identity', aes(col=coalicion), size=2,alpha = 0.4,show.legend = FALSE) +
scale_color_viridis_d() +
coord_flip()+
ylim(-1.1, 1.1)+
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
theme_bw()
plot2
ggsave(plot = plot2, "puntos_ideales_colectivo.png", width = 5, height = 5, units = "in", dpi = 300)
## Ridges
plot22 <- ggplot(df_graph, aes(x= coord, y = reorder(factor(coalicion), coord))) +
labs(x = "Izquierda                                       Derecha", y = "Colectivo") +
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
geom_density_ridges_gradient(scale = .9, gradient_lwd = .5)
plot22
ggsave(plot = plot22, "puntos_ideales_colectivo2.png", width = 5, height = 5, units = "in", dpi = 300)
## Ridges color
plot23 <- ggplot(df_graph, aes(x= coord, y = reorder(factor(coalicion), coord), fill = stat(x))) +
geom_density_ridges_gradient() +
labs(x = "Izquierda                                                                                                  Derecha", y = "Colectivo") +
labs(caption = "Fuente: tresquintos.cl") +
theme(plot.caption=element_text(size=rel(.3)))+
scale_fill_viridis_c(name = "Densidad", option = "D")+
theme_minimal() +
theme(legend.position = "none")
plot23
ggsave(plot = plot23, "puntos_ideales_colectivo3.png", width = 9, height = 5, units = "in", dpi = 300)
